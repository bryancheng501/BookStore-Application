var username
var password

/*
Index functions:
    createAccount()
    logIn()
*/

function createAccount(){
    username = document.getElementById('username').value
    password = document.getElementById('password').value

    if (!username || !password){
        alert("Please input a username and password!")
        return;
    }

    let req = new XMLHttpRequest()
    req.onreadystatechange = function(){
        if (this.readyState==4 && this.status == 200){
            alert(this.responseText);
        }
    }
    req.open('POST', '/createAccount')
    req.setRequestHeader('Content-type', 'application/json')
    req.send(JSON.stringify({'username' : username, 'password' : password}))

}

/*
function logIn(){
    username = document.getElementById('username').value
    password = document.getElementById('password').value

    if (!username || !password){
        alert("Please input a username and password!")
        return;
    }

    let req = new XMLHttpRequest()
    req.onreadystatechange = function(){
        if (this.readyState==4 && this.status == 200){
            response = JSON.parse(this.responseText)
            if (response.loggedIn){
                alert('Succesfully logged in!')
                //redirect them based on account type
                if (response.type == 'customer'){
                    window.location.href = "/customerPage"
                }
            }   else{
                alert('Invalid username and/or password!')
            }
        }
    }
    req.open('POST', '/logIn')
    req.setRequestHeader('Content-type', 'application/json')
    req.send(JSON.stringify({'username' : username, 'password' : password}))
}
*/

/*
Customer Page

*/

//Search for books
function search(){
    let searchQuery = document.getElementById('search').value
    let searchType = document.getElementById('searchType').options[document.getElementById('searchType').selectedIndex].value
    let genre = document.getElementById('genre').options[document.getElementById('genre').selectedIndex].value

    if (!searchQuery){
        alert("Please enter a search query!")
        return
    }

    let req = new XMLHttpRequest()
    req.onreadystatechange = function(){
        if (this.readyState==4 && this.status == 200){
            response = JSON.parse(this.responseText)
            loadBooks(response)
        }
    }

    let reqHeader = '/searchBooks/' + searchQuery + '/' + searchType
    if (genre){
        reqHeader += ('/' + genre)
    }

    req.open('GET', reqHeader)
    req.send()
}


//load books generated by search
function loadBooks(books){
    let booksDiv = document.getElementById('books')
    booksDiv.innerHTML = ""
    if (books.length > 0){
        let checkout = document.createElement('button')
        checkout.type = 'button'
        checkout.onclick = 'addQuestions()'
        checkout.innerHTML = 'Checkout'
        booksDiv.appendChild(checkout)
        booksDiv.innerHTML += '<br>'
    }
    //Display books generated by search
    for (i = 0; i < books.length; i++){
        //make html for all the book info
        let title = document.createElement('label')
        title.style.fontSize = 'larger'
        title.innerHTML = '<br>' + books[i].title + '<br>'
    
        let bookInfo = document.createElement('label')
        bookInfo.innerHTML += books[i].num_pages + ' pages<br>' + books[i].author + '<br>'
        bookInfo.innerHTML += books[i].publisher_name + '<br>' + books[i].genre + '<br>' + books[i].isbn
        bookInfo.innerHTML += '<br>$' + books[i].price + '<br><br><br>'

        //creating checkboxes to add books to checkout cart
        let cb = document.createElement('input')
        cb.type = 'checkbox'
        cb.className = 'booksToAdd'

        //adding to HTML
        booksDiv.appendChild(cb)
        booksDiv.appendChild(title)
        booksDiv.appendChild(bookInfo)
    }
}

//add questions to checkout
function addQuestions(){
    console.log('time to do stuff')
}